<?phpif (! defined('BASEPATH'))		exit('No direct script access allowed');		/*	 *	 * @author : Sharif Uddin	 * date : October 21, 2017	 */	class Role extends MY_Controller{				function __construct(){			parent::__construct();			$this->component = 'role';			$this->load->model('rolemodel');			$this->model = $this->model;		}				/**		 * *default functin, redirects to login page if no admin logged in yet**		 */		public function index(){			redirect(base_url() . $this->component.'/search', 'refresh');		}				public function commonTasks(){			$data = parent::commonTasks();			$data['component'] = $this->component;						return $data;		}				public function search(){			$data = $this->commonTasks();			$data = $this->commonSearch($data);			$data['search'] = '';			if($this->input->post('search')!=null)				$data['search'] = $this->input->post('search');						$data['page_title'] = $this->component.' Search';			$data['page_name'] = $this->component.' Search';			$data['searchAction'] = base_url() . $this->component.'/search';			$data['searchDisplayTxt'] = 'searchDisplayTxt';						$searchSQL = "SELECT * FROM role WHERE uniqueCode LIKE '%".$data['search']."%' ";			$pageSQL = " LIMIT ".($data['pageNo']-1)*$data['limit'].",  ".$data['limit'];			$query = $this->db->query($searchSQL);			$data['total'] = $query->num_rows();			$query1 = $this->db->query($searchSQL.$pageSQL);			$data['searchData'] = $query1->result();						$data['propertyArr'] = ['uniqueCode'=>'Name', 'description'=>'Description'];						$data['addmodifyAction'] = $this->component .'/add';			$this->load->view($this->userType . '/'.$this->component .'/search/index.php', $data);					}				public function add($id = 0) {			$data = $this->commonTasks();			if ($id > 0)				$data['page_title'] = 'Modify '.$this->component;				else					$data['page_title'] = 'Add '.$this->component;										$data['page_name'] = $this->component;										$rsObj = $this->model->getById($id);					$data['inputs'] = $this->model->getUiObject($rsObj);										$this->load->view($this->userType . '/'.$this->component.'/add/index', $data);		}				public function save($id = 0)				{			$data = $this->commonTasks();						$data['page_title'] = 'Add '.$this->component;						$data['page_name'] = 'home';						$this->model->save1();						redirect(base_url() .$this->component.'/search', 'refresh');		}				public function delete(){			$data = $this->commonTasks();			$data['page_title'] = 'Delete '.ucfirst($this->component);			$data['page_name'] = $this->component;;						if ($this->model->delete1()) {				redirect(base_url($this->component.'/search'), 'refresh');			} else {				$rsObj = $this->model->getById($id);				$data['inputs'] = $this->model->getUiObject($rsObj);				$this->load->view($this->userType . '/' . $this->component . '/add/index', $data);			}		}				public function assignment(){			$data = $this->commonTasks();			$data['page_title'] = 'User-Role Assignment';			$data['page_name'] = 'home';			$userId  = -1;			if($this->input->post('userId') !=null){				$userId = $this->input->post('userId');			}						if($this->input->post('assign') != null){				$roles = $this->input->post('roles');				$userId = $this->input->post('userId');				$this->db->where('userId', $userId);				$this->db->delete('userrole');								foreach ($roles as $roleId):					$this->db->insert('userrole', ['userId'=>$userId, 'roleId'=>$roleId]);				endforeach;				}						$data['searchAction'] = 'role/assignment';			$data['assignAction'] = 'role/assignment';			$data['userId'] = $userId;			$data['user'] = array('-1' => 'Select user');			foreach ($this->load('user') as $row){				$data['user'][$row->componentId] = $row->firstName.' '.$row->lastName.' ('.$row->uniqueCode.')';			}			$query = $this->db->query("SELECT r.componentId, r.uniqueCode, IFNULL(ur.userId, 0) assigned								FROM role r								LEFT JOIN userrole ur ON (r.componentId = ur.roleId AND ur.userId = $userId)");			$data['searchData'] = $query->result();			$this->load->view($this->userType . '/' . $this->component . '/roleassign/index', $data);		}	}